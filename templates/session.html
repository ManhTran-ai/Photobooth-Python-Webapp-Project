{% extends "base.html" %}
{% block title %}Ch·ªânh s·ª≠a - Photobooth{% endblock %}
{% block content %}

<div class="session-page">
    <div class="session-container">
        <div class="session-header">
            <h1>Ch·ªânh s·ª≠a b·ªô ·∫£nh</h1>
            <p>Ch·ªçn m·∫´u, m√†u s·∫Øc, sticker v√† b·ªô l·ªçc cho 4 ·∫£nh c·ªßa b·∫°n</p>
        </div>

        <div class="session-layout" style="display:flex; gap:24px; align-items:flex-start;">
            <div class="photos-panel" style="flex:0 0 540px;">
                <!-- Template choices -->
                <div style="display:flex; gap:10px; margin-bottom:12px;">
                    <button id="tpl-1x4" class="btn control-tab active">1x4</button>
                    <button id="tpl-2x2" class="btn control-tab">2x2</button>
                </div>

                <!-- White frame preview -->
                <div id="frame-wrapper" style="background:#fff; border-radius:8px; padding:18px; box-shadow:0 8px 30px rgba(0,0,0,0.12);">
                    <svg id="collage-svg" width="420" height="1200" xmlns="http://www.w3.org/2000/svg" style="display:block; margin:0 auto; background:#ffffff;"></svg>
                </div>
            </div>

            <div style="flex:1 1 420px;">
                <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
                    <h4 class="control-label">Khung m√†u:<input type="color" id="color-frame" value="#ffffff" style="margin-left:8px;"></h4>
                </div>

                <h4>Sticker</h4>
                <div id="icons-list" class="icons-list" style="display:flex; flex-wrap:wrap; gap:10px; max-height:420px; overflow:auto; padding:8px; background:transparent;"></div>

                <h4 style="margin-top:18px;">B·ªô l·ªçc</h4>
                <div id="filters-list" class="filters-list" style="display:flex; gap:8px; flex-wrap:wrap; max-height:240px; overflow:auto; padding:8px;"></div>

                <!-- Effect UI removed (duplicates with 'B·ªô l·ªçc') -->

                <!-- AI Beauty Section -->
                <h4 style="margin-top:18px;">ü§ñ AI Beauty (Face Detection)</h4>
                <div class="ai-beauty-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:8px; padding:12px; margin-bottom:12px;">
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button id="ai-smart-beauty" class="btn btn-ai" style="background:#fff; color:#667eea; border:none; padding:8px 16px; border-radius:20px; font-weight:600; cursor:pointer;">
                            ‚ú® Smart Beauty
                        </button>
                        <button id="ai-face-glow" class="btn btn-ai" style="background:#fff; color:#764ba2; border:none; padding:8px 16px; border-radius:20px; font-weight:600; cursor:pointer;">
                            üí´ Face Glow
                        </button>
                        <button id="ai-portrait-pro" class="btn btn-ai" style="background:#fff; color:#e91e63; border:none; padding:8px 16px; border-radius:20px; font-weight:600; cursor:pointer;">
                            üë§ Portrait Pro
                        </button>
                    </div>
                    <p style="color:#fff; font-size:12px; margin-top:8px; margin-bottom:0;">
                        <strong>Tip:</strong> AI filters ch·ªâ l√†m ƒë·∫πp v√πng khu√¥n m·∫∑t, gi·ªØ nguy√™n background!
                    </p>
                </div>

                <!-- Auto Sticker Section -->
                <h4>üé≠ Ph·ª• ki·ªán (Face-based)</h4>
                <div class="auto-sticker-section" style="background:#f8f9fa; border-radius:8px; padding:12px; margin-bottom:12px;">
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn-auto-sticker" data-type="glasses" style="padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; transition: all 0.2s;">
                            üï∂Ô∏è K√≠nh
                        </button>
                        <button class="btn-auto-sticker" data-type="hat" style="padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; transition: all 0.2s;">
                            üß¢ M≈©
                        </button>
                        <button class="btn-auto-sticker" data-type="noel_hat" style="padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; transition: all 0.2s;">
                            üéÖ N√≥n Noel
                        </button>
                        <button class="btn-auto-sticker" data-type="mustache" style="padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; transition: all 0.2s;">
                            ü•∏ R√¢u
                        </button>
                        <button class="btn-auto-sticker" data-type="bow" style="padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; transition: all 0.2s;">
                            üéÄ N∆°
                        </button>
                        <button class="btn-auto-sticker" data-type="ears" style="padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; transition: all 0.2s;">
                            üê∞ Tai th·ªè
                        </button>
                    </div>
                    <p style="color:#666; font-size:12px; margin-top:8px; margin-bottom:0;">
                        <strong>üí° Tip:</strong> Click ƒë·ªÉ g·∫Øn ph·ª• ki·ªán t·ª± ƒë·ªông v√†o khu√¥n m·∫∑t
                    </p>
                </div>

                <div style="margin-top:18px; display:flex; gap:12px; flex-wrap:wrap;">
                    <button id="apply-preview-btn" class="btn btn-primary" style="padding:12px 24px; font-size:14px;">
                        üîÑ Xem tr∆∞·ªõc
                    </button>
                    <button id="export-collage-btn" class="btn" style="padding:12px 24px; font-size:14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border:none; border-radius:8px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:8px;">
                        üì• T·∫£i xu·ªëng
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center; flex-direction:column;">
            <div style="background:#fff; padding:30px 50px; border-radius:12px; text-align:center;">
                <div style="font-size:40px; margin-bottom:15px;">‚è≥</div>
                <div id="loading-text" style="font-size:16px; color:#333;">ƒêang x·ª≠ l√Ω...</div>
            </div>
        </div>

        <!-- SVG preview -->
        <div style="display:none">
            <svg id="collage-svg"></svg>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script id="session-data" type="application/json">{"session_id": "{{ session_id }}", "stickers": {{ stickers|tojson|safe }}}</script>
<script src="{{ url_for('static', filename='js/session_collage.js') }}"></script>
<script src="{{ url_for('static', filename='js/session.js') }}"></script>
{% endblock %}

