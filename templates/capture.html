{% extends "base.html" %}
{% block title %}Ch·ª•p h√¨nh - Photobooth{% endblock %}
{% block content %}

<div class="capture-page">
    <div class="capture-container">
        <!-- Top controls (delay, upload) -->
        <div class="top-controls">
            <div class="selectors">
                <label class="selector">
                    <select id="delay-select">
                        <option value="0">Kh√¥ng ƒë·∫øm</option>
                        <option value="3" selected>Tr·ªÖ 3 gi√¢y</option>
                        <option value="5">Tr·ªÖ 5 gi√¢y</option>
                    </select>
                </label>
            </div>
            <div class="upload-action">
                <a href="/upload" class="btn btn-outline" id="upload-btn">
                    <i class="icon">üì§</i> T·∫£i l√™n ·∫£nh
                </a>
            </div>
        </div>

        <div class="capture-layout">
            <!-- Left QR / Info panel -->
            <aside class="left-panel">
                <div class="qr-card">
                    <p class="qr-text">T·∫£i ·ª©ng d·ª•ng ƒë·ªÉ d√πng v√¥ v√†n khung h√¨nh, sticker v√† c√¥ng c·ª• l√†m ƒë·∫πp!</p>
                    <div class="qr-image-placeholder" aria-hidden="true">QR</div>
                    <p class="qr-sub">Qu√©t ƒë·ªÉ t·∫£i xu·ªëng</p>
                </div>
            </aside>

            <!-- Center: large video preview -->
            <main class="center-panel">
                <div class="video-wrapper">
                    <video id="video" autoplay muted playsinline></video>
                    <canvas id="canvas" style="display: none;"></canvas>
                </div>

                <div class="controls-row">
                    <button class="btn btn-secondary" id="start-session-btn">B·∫Øt ƒë·∫ßu</button>
                    <button class="btn btn-capture-large" id="capture-btn" style="display:none;">Ch·ª•p</button>
                    <button class="btn btn-primary btn-continue" id="proceed-btn" style="display:none;margin-left:12px;">Ti·∫øp</button>
                    <!-- enable-camera-btn may be created dynamically by JS; include a placeholder for styling -->
                    <button class="btn btn-outline" id="enable-camera-btn" style="display:none;margin-left:12px;">B·∫≠t camera</button>
                </div>
            </main>

            <!-- Right: thumbnails -->
            <aside class="right-panel">
                <div class="thumb-list" id="thumb-list">
                    <!-- thumbnails appended here -->
                    <div class="thumb empty"></div>
                    <div class="thumb empty"></div>
                    <div class="thumb empty"></div>
                    <div class="thumb empty"></div>
                </div>
            </aside>
        </div>

        <!-- Countdown Overlay -->
        <div class="countdown-overlay" id="countdown-overlay" style="display: none;">
            <div class="countdown-content">
                <div class="countdown-number" id="countdown-number">3</div>
            </div>
        </div>

        <!-- Flash Effect -->
        <div class="flash-effect" id="flash-effect"></div>

        <!-- Preview Modal (confirm / retake) -->
        <div class="preview-modal" id="preview-modal" style="display: none;">
            <div class="preview-content">
                <h3 id="preview-title">Xem tr∆∞·ªõc</h3>
                <img id="preview-image" src="" alt="Preview">
                <div class="preview-buttons">
                    <button class="btn btn-primary" id="confirm-btn">Ti·∫øp</button>
                    <button class="btn btn-danger" id="retake-btn">Ch·ª•p l·∫°i</button>
                </div>
            </div>
        </div>

        <!-- Loading & Error -->
        <div class="loading-overlay" id="loading-overlay" style="display: none;">
            <div class="loading-spinner"></div>
            <p id="loading-text">ƒêang x·ª≠ l√Ω...</p>
        </div>

        <div class="error-message" id="error-message" style="display: none;">
            <p id="error-text"></p>
            <button class="btn btn-primary" id="error-close">OK</button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/capture.js') }}"></script>
{% endblock %}

